<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>家谱全图 - 郑氏族谱(新)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Noto Serif SC', 'Source Han Serif SC', 'SimSun', serif;
        }
        
        body {
            background: linear-gradient(135deg, #f9f7f0, #e8e5d8);
            color: #3a3325;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1400px;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            margin-top: 20px;
            border: 1px solid #e0d9c5;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #d4c8a6;
        }
        
        h1 {
            font-size: 3.2rem;
            margin-bottom: 5px;
            color: #8c5e3c;
            letter-spacing: 3px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .subtitle {
            font-size: 1.4rem;
            color: #a1886f;
            font-style: italic;
            letter-spacing: 2px;
        }
        
        /* 标签页样式 */
        .tabs {
            display: flex;
            margin-bottom: 25px;
            background: #f1ede4;
            border-radius: 12px;
            padding: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            border: 1px solid #d8d0bc;
        }
        
        .tab {
            flex: 1;
            text-align: center;
            padding: 16px;
            cursor: pointer;
            border-radius: 10px;
            font-weight: 600;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            color: #7a6e5a;
        }
        
        .tab.active {
            background: #d4c8a6;
            color: #5a4a32;
            box-shadow: 0 4px 15px rgba(140, 94, 60, 0.2);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .viewer-container {
            position: relative;
            width: 100%;
            height: 70vh;
            background: #f8f5ec;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
            border: 1px solid #d8d0bc;
            touch-action: none;
        }
        
        .svg-container {
            width: 100%;
            height: 100%;
            cursor: grab;
            background-image: 
                linear-gradient(#e6dfcf 1px, transparent 1px),
                linear-gradient(90deg, #e6dfcf 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        .svg-container:active {
            cursor: grabbing;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            padding: 15px 0;
        }
        
        .zoom-info {
            background: #f1ede4;
            padding: 10px 25px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            min-width: 150px;
            text-align: center;
            border: 1px solid #d8d0bc;
            color: #5a4a32;
        }
        
        .btn {
            background: #8c5e3c;
            color: #f9f7f0;
            border: none;
            padding: 12px 28px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(140, 94, 60, 0.3);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(140, 94, 60, 0.4);
            background: #7a4e2c;
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .subtitle {
                font-size: 1.1rem;
            }
            
            .viewer-container {
                height: 55vh;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .tabs {
                flex-direction: column;
                border-radius: 12px;
            }
        }
        
        .zoom-controls {
            display: flex;
            gap: 10px;
        }
        
        .zoom-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            font-weight: bold;
        }
        
        .watermark {
            position: absolute;
            bottom: 15px;
            right: 15px;
            color: rgba(140, 94, 60, 0.2);
            font-size: 1.2rem;
            font-weight: bold;
            pointer-events: none;
            user-select: none;
        }
        
        .help-text {
            text-align: center;
            margin-top: 15px;
            color: #7a6e5a;
            font-size: 0.95rem;
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #8c5e3c;
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .mobile-instructions {
            display: none;
            text-align: center;
            margin-top: 15px;
            color: #7a6e5a;
            font-size: 0.9rem;
            padding: 10px;
            background: #f1ede4;
            border-radius: 10px;
        }
        
        @media (max-width: 768px) {
            .mobile-instructions {
                display: block;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>家谱全图</h1>
            <p class="subtitle">--郑氏族谱(新)</p>
        </header>
        
        <!-- 标签页导航 -->
        <div class="tabs">
            <div class="tab active" data-tab="tab1">图1</div>
            <div class="tab" data-tab="tab2">图2</div>
        </div>
        
        <!-- 标签页1内容 -->
        <div id="tab1" class="tab-content active">
            <div class="viewer-container">
                <div id="svg-container-1" class="svg-container">
                    <div class="loading">正在加载家谱图...</div>
                    <div class="watermark">郑氏族谱</div>
                </div>
            </div>
            
            <div class="controls">
                <div class="zoom-info">
                    缩放比例: <span id="zoom-level-1">100%</span>
                </div>
                
                <div class="zoom-controls">
                    <button class="btn zoom-btn" id="zoom-in-1">+</button>
                    <button class="btn zoom-btn" id="zoom-out-1">-</button>
                    <button class="btn" id="reset-view-1">恢复全图</button>
                </div>
            </div>
            <p class="help-text">descendants-chart.svg - 家族树状图</p>
            <p class="mobile-instructions">双指缩放 · 单指拖动</p>
        </div>
        
        <!-- 标签页2内容 -->
        <div id="tab2" class="tab-content">
            <div class="viewer-container">
                <div id="svg-container-2" class="svg-container">
                    <div class="loading">正在加载家谱图...</div>
                    <div class="watermark">郑氏族谱</div>
                </div>
            </div>
            
            <div class="controls">
                <div class="zoom-info">
                    缩放比例: <span id="zoom-level-2">100%</span>
                </div>
                
                <div class="zoom-controls">
                    <button class="btn zoom-btn" id="zoom-in-2">+</button>
                    <button class="btn zoom-btn" id="zoom-out-2">-</button>
                    <button class="btn" id="reset-view-2">恢复全图</button>
                </div>
            </div>
            <p class="help-text">gvexport.svg - 家族关系图</p>
            <p class="mobile-instructions">双指缩放 · 单指拖动</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 标签页切换功能
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // 移除所有active类
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
                    
                    // 添加active类到当前标签
                    tab.classList.add('active');
                    const tabId = tab.getAttribute('data-tab');
                    document.getElementById(tabId).classList.add('active');
                });
            });
            
            // 创建SVG查看器类
            class SvgViewer {
                constructor(containerId, zoomLevelId, zoomInId, zoomOutId, resetId, svgName) {
                    this.container = document.getElementById(containerId);
                    this.zoomLevelElement = document.getElementById(zoomLevelId);
                    this.zoomInButton = document.getElementById(zoomInId);
                    this.zoomOutButton = document.getElementById(zoomOutId);
                    this.resetButton = document.getElementById(resetId);
                    this.svgName = svgName;
                    
                    // 缩放状态
                    this.scale = 1;
                    this.viewBox = { x: 0, y: 0, width: 800, height: 600 };
                    this.minScale = 0.05; // 更小的最小缩放比例
                    this.maxScale = 10;   // 更大的最大缩放比例
                    this.isDragging = false;
                    this.startX = 0;
                    this.startY = 0;
                    this.startViewBoxX = 0;
                    this.startViewBoxY = 0;
                    
                    // 触摸状态
                    this.touchStartDistance = 0;
                    this.touchStartScale = 1;
                    this.touchCenterX = 0;
                    this.touchCenterY = 0;
                    
                    // SVG原始尺寸
                    this.originalWidth = 0;
                    this.originalHeight = 0;
                    
                    // 初始化SVG
                    this.initSvg();
                    
                    // 绑定事件
                    this.bindEvents();
                }
                
                async initSvg() {
                    try {
                        // 创建SVG元素
                        const svgNS = "http://www.w3.org/2000/svg";
                        this.svg = document.createElementNS(svgNS, "svg");
                        this.svg.setAttribute("id", "svg-viewer");
                        this.svg.setAttribute("width", "100%");
                        this.svg.setAttribute("height", "100%");
                        this.svg.setAttribute("viewBox", "0 0 800 600");
                        this.svg.setAttribute("preserveAspectRatio", "xMidYMid meet");
                        
                        // 创建可缩放的SVG组
                        this.zoomGroup = document.createElementNS(svgNS, "g");
                        this.zoomGroup.setAttribute("id", "zoom-group");
                        
                        // 加载实际SVG文件
                        const response = await fetch(this.svgName);
                        if (!response.ok) {
                            throw new Error(`无法加载SVG文件: ${this.svgName}`);
                        }
                        const svgData = await response.text();
                        
                        // 解析SVG内容
                        const parser = new DOMParser();
                        const svgDoc = parser.parseFromString(svgData, "image/svg+xml");
                        const svgContent = svgDoc.querySelector('svg');
                        
                        if (!svgContent) {
                            throw new Error(`无效的SVG文件: ${this.svgName}`);
                        }
                        
                        // 获取原始尺寸
                        const viewBox = svgContent.getAttribute('viewBox');
                        if (viewBox) {
                            const [x, y, width, height] = viewBox.split(' ').map(Number);
                            this.originalWidth = width;
                            this.originalHeight = height;
                        } else {
                            this.originalWidth = parseFloat(svgContent.getAttribute('width') || 800);
                            this.originalHeight = parseFloat(svgContent.getAttribute('height') || 600);
                        }
                        
                        // 将SVG内容添加到缩放组
                        while (svgContent.firstChild) {
                            this.zoomGroup.appendChild(svgContent.firstChild);
                        }
                        
                        this.svg.appendChild(this.zoomGroup);
                        this.container.appendChild(this.svg);
                        
                        // 移除加载提示
                        this.container.querySelector('.loading').remove();
                        
                        // 初始化视图 - 确保图片完整显示
                        setTimeout(() => this.resetView(), 100);
                    } catch (error) {
                        console.error(error);
                        this.showError(error);
                    }
                }
                
                showError(error) {
                    const loadingElement = this.container.querySelector('.loading');
                    loadingElement.textContent = `加载失败: ${error.message}`;
                    loadingElement.style.color = '#e74c3c';
                    loadingElement.style.fontWeight = 'bold';
                }
                
                updateView() {
                    this.svg.setAttribute("viewBox", 
                        `${this.viewBox.x} ${this.viewBox.y} ${this.viewBox.width} ${this.viewBox.height}`);
                    this.zoomLevelElement.textContent = `${Math.round(this.scale * 100)}%`;
                }
                
                zoomAtPoint(scaleFactor, clientX, clientY) {
                    const containerRect = this.container.getBoundingClientRect();
                    const mouseX = clientX - containerRect.left;
                    const mouseY = clientY - containerRect.top;
                    
                    // 计算鼠标在SVG坐标中的位置
                    const svgX = this.viewBox.x + (mouseX / containerRect.width) * this.viewBox.width;
                    const svgY = this.viewBox.y + (mouseY / containerRect.height) * this.viewBox.height;
                    
                    // 计算新的缩放比例
                    const newScale = Math.max(this.minScale, Math.min(this.maxScale, this.scale * scaleFactor));
                    
                    // 如果缩放比例没有变化，则返回
                    if (newScale === this.scale) return;
                    
                    // 计算缩放后的视口大小
                    const newWidth = this.viewBox.width * (this.scale / newScale);
                    const newHeight = this.viewBox.height * (this.scale / newScale);
                    
                    // 调整视口位置以保持鼠标位置不变
                    this.viewBox.x = svgX - (mouseX / containerRect.width) * newWidth;
                    this.viewBox.y = svgY - (mouseY / containerRect.height) * newHeight;
                    this.viewBox.width = newWidth;
                    this.viewBox.height = newHeight;
                    
                    this.scale = newScale;
                    this.updateView();
                }
                
                resetView() {
                    // 重置视图并确保图片完整显示
                    const containerRect = this.container.getBoundingClientRect();
                    const containerWidth = containerRect.width;
                    const containerHeight = containerRect.height;
                    
                    // 计算缩放比例，使图片完整显示在容器中
                    const scaleX = containerWidth / this.originalWidth;
                    const scaleY = containerHeight / this.originalHeight;
                    const scale = Math.min(scaleX, scaleY);
                    
                    // 计算新的视口大小
                    const newWidth = this.originalWidth * scale;
                    const newHeight = this.originalHeight * scale;
                    
                    // 计算居中位置
                    const x = (this.originalWidth - newWidth) / 2;
                    const y = (this.originalHeight - newHeight) / 2;
                    
                    this.viewBox = {
                        x: x,
                        y: y,
                        width: newWidth,
                        height: newHeight
                    };
                    this.scale = 1;
                    this.updateView();
                }
                
                bindEvents() {
                    // 鼠标滚轮缩放（以鼠标位置为中心）
                    this.container.addEventListener('wheel', (e) => {
                        e.preventDefault();
                        // 增加缩放速度 - 使用更大的缩放因子
                        const scaleFactor = e.deltaY > 0 ? 0.6 : 1.8;
                        this.zoomAtPoint(scaleFactor, e.clientX, e.clientY);
                    });
                    
                    // 鼠标拖动平移
                    this.container.addEventListener('mousedown', (e) => {
                        if (e.button !== 0) return; // 只处理左键
                        
                        this.isDragging = true;
                        this.startX = e.clientX;
                        this.startY = e.clientY;
                        this.startViewBoxX = this.viewBox.x;
                        this.startViewBoxY = this.viewBox.y;
                        this.container.style.cursor = 'grabbing';
                    });
                    
                    document.addEventListener('mousemove', (e) => {
                        if (!this.isDragging) return;
                        
                        const dx = e.clientX - this.startX;
                        const dy = e.clientY - this.startY;
                        
                        // 计算在SVG坐标系中的移动距离
                        const moveX = (dx / this.container.clientWidth) * this.viewBox.width;
                        const moveY = (dy / this.container.clientHeight) * this.viewBox.height;
                        
                        this.viewBox.x = this.startViewBoxX - moveX;
                        this.viewBox.y = this.startViewBoxY - moveY;
                        
                        this.updateView();
                    });
                    
                    document.addEventListener('mouseup', () => {
                        this.isDragging = false;
                        this.container.style.cursor = 'grab';
                    });
                    
                    // 按钮事件
                    this.resetButton.addEventListener('click', () => {
                        this.resetView();
                    });
                    
                    this.zoomInButton.addEventListener('click', () => {
                        // 以中心点进行缩放
                        const containerRect = this.container.getBoundingClientRect();
                        const centerX = containerRect.left + containerRect.width / 2;
                        const centerY = containerRect.top + containerRect.height / 2;
                        this.zoomAtPoint(1.8, centerX, centerY);
                    });
                    
                    this.zoomOutButton.addEventListener('click', () => {
                        // 以中心点进行缩放
                        const containerRect = this.container.getBoundingClientRect();
                        const centerX = containerRect.left + containerRect.width / 2;
                        const centerY = containerRect.top + containerRect.height / 2;
                        this.zoomAtPoint(0.6, centerX, centerY);
                    });
                    
                    // 触摸事件 - 单指拖动
                    this.container.addEventListener('touchstart', (e) => {
                        if (e.touches.length === 1) {
                            const touch = e.touches[0];
                            this.isDragging = true;
                            this.startX = touch.clientX;
                            this.startY = touch.clientY;
                            this.startViewBoxX = this.viewBox.x;
                            this.startViewBoxY = this.viewBox.y;
                        } else if (e.touches.length === 2) {
                            // 双指缩放
                            const touch1 = e.touches[0];
                            const touch2 = e.touches[1];
                            
                            // 计算双指距离
                            const dx = touch1.clientX - touch2.clientX;
                            const dy = touch1.clientY - touch2.clientY;
                            this.touchStartDistance = Math.sqrt(dx * dx + dy * dy);
                            
                            // 计算双指中心点
                            this.touchCenterX = (touch1.clientX + touch2.clientX) / 2;
                            this.touchCenterY = (touch1.clientY + touch2.clientY) / 2;
                            
                            this.touchStartScale = this.scale;
                        }
                    });
                    
                    this.container.addEventListener('touchmove', (e) => {
                        e.preventDefault();
                        
                        if (e.touches.length === 1 && this.isDragging) {
                            // 单指拖动
                            const touch = e.touches[0];
                            const dx = touch.clientX - this.startX;
                            const dy = touch.clientY - this.startY;
                            
                            // 计算在SVG坐标系中的移动距离
                            const moveX = (dx / this.container.clientWidth) * this.viewBox.width;
                            const moveY = (dy / this.container.clientHeight) * this.viewBox.height;
                            
                            this.viewBox.x = this.startViewBoxX - moveX;
                            this.viewBox.y = this.startViewBoxY - moveY;
                            
                            this.updateView();
                        } else if (e.touches.length === 2) {
                            // 双指缩放
                            const touch1 = e.touches[0];
                            const touch2 = e.touches[1];
                            
                            // 计算当前双指距离
                            const dx = touch1.clientX - touch2.clientX;
                            const dy = touch1.clientY - touch2.clientY;
                            const touchDistance = Math.sqrt(dx * dx + dy * dy);
                            
                            // 计算缩放比例
                            const scaleFactor = touchDistance / this.touchStartDistance;
                            const newScale = this.touchStartScale * scaleFactor;
                            
                            // 限制缩放范围
                            if (newScale < this.minScale || newScale > this.maxScale) return;
                            
                            // 应用缩放
                            this.zoomAtPoint(scaleFactor, this.touchCenterX, this.touchCenterY);
                        }
                    });
                    
                    this.container.addEventListener('touchend', () => {
                        this.isDragging = false;
                    });
                }
            }
            
            // 初始化两个SVG查看器
            const viewer1 = new SvgViewer(
                'svg-container-1', 
                'zoom-level-1', 
                'zoom-in-1', 
                'zoom-out-1', 
                'reset-view-1',
                'descendants-chart.svg'
            );
            
            const viewer2 = new SvgViewer(
                'svg-container-2', 
                'zoom-level-2', 
                'zoom-in-2', 
                'zoom-out-2', 
                'reset-view-2',
                'gvexport.svg'
            );
        });
    </script>
</body>
</html>